<!DOCTYPE html>
<html>
 <!-- Simulation of the operation of an automatic firefighting branch, e.g. TFT -->
 <!-- Attempt to use a simplified fluid flow model to adjust pressures/flow rates throughout a section of hose, valves and other infrastructure -->
 <!-- Created by Tristan Miller, May 2018 -->
 <!-- Download and then open in your browser. -->
<head>
<meta charset="utf-8">
<title>Automatic Branch Simulation</title>
<style>

//this CSS is terrible and I feel bad about it
canvas {
    border: 0px #CCC solid;
}

input[type="checkbox"]
{
  /* Double-sized Checkboxes */
  -ms-transform: scale(2); /* IE */
  -moz-transform: scale(2); /* FF */
  -webkit-transform: scale(2); /* Safari and Chrome */
  -o-transform: scale(2); /* Opera */
  padding: 10px;
}

#controls
{
  font-size: 110%;
  display: inline;
  padding:5px;
  padding-top: 0px;
}

label
{
 padding: 15px;
 padding-right: 2px;
}

div, button
{
 margin: 5px;
 margin-left:10px;
}

h2
{
 padding:0px;
 margin:0px;
}


</style>
</head>
<body>
<h1 id="theTitle">AutoBranch</h1>
<h2 id="status">0 | 0</h2>



<script>


//OBJECTS NEEDED
//Pipe element
/* 	fluid velocity
	fluid pressure
	fluid density
	mass of fluid in that section
	fluid resistance (function of fluid velocity)
	pressure drop across element (function of fluid velocity and fluid resistance)
	connections to other elements
	flow in
	flow out
*/

//Pipe 'network'
/*	Ordered list of pipe elements to imply connections betweeen elements
	This connectivity will hopefully end up being embedded in the pipe elements themselves -
	leaving this as a means of grouping elements that are in important sub-sections of the pipe network

*/

var rho = 1.0 // density of fluid, g/cm^3
var K = 2e8; //  bulk modulus of fluid, Pa

var PipeElement = function(diam, length) {
    this.diam = diam;
	this.length = length;
	this.volume = (Math.PI*diam*diam*0.25)*this.length
	this.mass = this.volume*this.density/1000; //cross-sectional area * length * density in g/mm^3
	//if(Math.random() > 0.8){this.square = true;}

    return this;
};


PipeElement.prototype = {
    diam: 64, //mm
	length: 1, //mm
	volume: 1, //cm^3
	mass: 1, //kg
	pressure: 0, //gauge pressure, Pa
	density: 1, //g/cm^3
	massOutL: 0, //g
	massOutR: 0, //g
	massIn: 0, //g
	label: "",
    //square: false,
	colour: "rgba(255, 200, 50, 1)";
	size: 20;  //size for rendering will depend on how many elements there are, and aesthetic considerations!


	//the following is dross from another program!
	
	updateDensity: function(this.mass, this.massOutL, this.massOutR, this.massIn) {
		this.mass = this.mass - this.massOutL - this.massOutR + this.massIn;
		this.density = this.mass/this.volume;

	}
	/*render: function(ctx) {
        ctx.fillStyle= this.colour;
		ctx.strokeStyle = "rgba(255,255,255,0.4)";
		ctx.lineWidth = 1;
		ctx.fillStyle= this.colour;
		ctx.beginPath();
		if(this.square){
			ctx.save();
			ctx.translate(this.posX - 0.5*this.size, this.posY - 0.5*this.size);
			ctx.rotate(2*Math.PI*this.ang/360);
			ctx.rect(0,0, this.size, this.size);

			ctx.fill();
			ctx.stroke();
			ctx.restore();
		} else {
			ctx.arc(this.posX,this.posY,0.5*this.size,0,2*Math.PI);
			ctx.fill();
			ctx.stroke();
		}
	},
	*/
	/*update: function() {
		this.posX = this.posX + this.velX;
		this.posY = this.posY + this.velY;
		this.size = 2*this.mass;

		if(this.square){
		this.ang = (this.ang + this.rot)%360;
		}

		if(this.walls){
			if((this.velX > 0 && this.posX > width) || (this.velX < 0 && this.posX < 0)){
				this.velX = -0.7*this.velX;
			}
			if((this.velY > 0 && this.posY > height) || (this.velY < 0 && this.posY < 0)){
				this.velY = -0.7*this.velY;
			}
		}
		this.iList = [];
	}*/
};



</script>
</body>
